branches:
  except:
    - dev
language: cpp
os:
  - windows
  - linux
  - osx
dist: xenial
addons:
  apt:
    sources:
      - sourceline: 'deb http://archive.ubuntu.com/ubuntu/ xenial-backports universe'
    packages:
      - ninja-build=1.7.1-1~ubuntu16.04.1
      - pkg-config
      - libnss3-dev
  homebrew:
    packages:
      - ninja
      - ccache
cache: false
install:
  - if [[ "${TRAVIS_OS_NAME}" == "windows" ]]; then export GYP_MSVS_OVERRIDE_PATH="/c/Program Files (x86)/Microsoft Visual Studio/2017/BuildTools" ; choco install windbg -y ; fi
script:
  - ./tools/import-upstream.sh
  - ( cd src; ./get-clang.sh )
  - # ccache -s
  - ( cd src; ./build.sh )
  - # ccache -s
  - ./tests/basic.sh src/out/Release/naive
  - ls -l src/out/Release/
  - export BUILD_NAME="naiveproxy-$TRAVIS_BRANCH-$TRAVIS_OS_NAME"
  - mkdir $BUILD_NAME
  - cp src/out/Release/naive src/config.json LICENSE USAGE.txt $BUILD_NAME
  - tar cJf $BUILD_NAME.tar.xz $BUILD_NAME
